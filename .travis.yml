language: java

jdk:
  - openjdk17

# Need a full git clone in order to be able to tag the release
git:
  clone: false

install:
  - git clone https://github.com/$TRAVIS_REPO_SLUG.git $TRAVIS_REPO_SLUG
  - cd $TRAVIS_REPO_SLUG
  - git checkout $TRAVIS_BRANCH
  - POM_VERSION=$(mvn -q -Dexec.executable=echo -Dexec.args='${project.version}' --non-recursive exec:exec | sed -e 's/-SNAPSHOT//')
  - openssl aes-256-cbc -K $encrypted_044baa266d1a_key -iv $encrypted_044baa266d1a_iv -in .travis/gpg.asc.enc -out .travis/gpg.asc -d
  - gpg --fast-import .travis/gpg.asc

env:
  global:
    # Environment variables referenced in .travis/maven-settings.xml. To encrypt and escape values correctly, run the following
    # command and enter ENV_VAR=value when prompted:
    # read -r && travis encrypt "$(printf %q "$REPLY")"
    - secure: P2wr7U/GoEXXhQ7jZe3I+nrxAuUTjvkP0MZ63v5Oz+JBnfGyEux+cXHsKSEO9jSyNcewibzjwyoX1Qb/hJ7VrxsV0cA3DT6rUCKkOGyb1SoC/rkisEJEQuYGTZYtSPMQ0agBWSR/Pyw5M3M6IBQDZ4lQMWMHnhkQDNoTi0TvprSRjLXI5novQx1dFUU3VyTmc9dovNrjoFWsxCn1DeNYpfZfFBXvK0lHdZFyMfQKNy+Or9Bvb/K+HFmWP0xvUCZz2/ZEAoXEKx4rfR7ZRfFIxN/x4DmqpS1ReFVH6ASsO+CwQuwVPXnX7HQxQllm7FrImxZjqap4CfTj9ce3vUQP4pVK82il6IVJIMfQO+YYhMDfC6IwrQLHuED5EWcuX6jIOcNuNYXzMiBzxGv8+fSt4SLnGMCe6QIOmh0OuBFutAI/eH2E4yNi4KPnBHwCn9+dcMjw7UlOa/c+PBmcSa4STrC5hUR8DlMjyYPNwaZRFROLY2Ezz0cGQd42BQkAnTc9tTDCpyBAaU8pJlh7qZEr+exLbpaceK53nKesyIftnw72zPGCTffwy4qPAQmTxE/ifM0wRNbhsytLq3ewNZaNb6/tdm7WpEnx5nCG4DvgsqCaD+r+SogETInZ3ICDqnATjYDwUaDLHU0XNGtSAZSt1BwjH2YgsAMxrO6Qp+kIfok=
    - secure: j/yy67LPHCuS5CqkDtcJKwtR7uD1eMo3arLZKMjDpwth2+JzFDqQNu3Ai2vd7zMrVANJxjROV8APxLRp+xB4fKLW7WDCjuI+qce74CqwwA3ViN25JYRJt7y8qXy3smNpjPdFzhM5HDRSA40Ju9UAaijRUotWQWd+kgneu+Z9X2kdZHCUcXoSZMCnNZQUGvPsmW+2YzOgyA/KlZ5g99dyJCte9sxjJx+swc4mtemxs7LBBeN+CG9uHMYex72AVq8VKGwYQQJckP7PsW8/CbdSBe+gG1G9x96mpYjRRa/Y/cR14wS7InYVS3JyRtRqwqHtwrnZs6Y3unVPbseD72SdAswNmxIC8VhisKFlR5+ZBWEUj7R9RCOMjaaSMtaRKVCp8zeFFiplfazXzMO2nEZ0vIbetwTToHEf38AAIYyKJlkGWxIbATVku6R7lKB9KwFpMcgnGUsiQIKlJR6LA9t/v4jkDyqABFAT7HdTDKSBL3PdiD6jidRI3MB8Pycxs/epAUIWbB0NyGl3fxJ6CrT7ZyiVOAo8EuWq+Z4bOF6rEtH+3oXlC/VHybkOYAH2+6R0uKDiDRjmxvZMFqFafYjRbnfRWUjtPERDVeRrhgVsTW3JtF/cWwJyv9FQfUbyDBVSlN0RWswX7MrEvMY6JkgLDZjhoaWF3gYtCv4sS5drxeI=
    - secure: A6vBxO82Q2mu2p/cRy+4LAjwxxMBf2fjjNBUl71QMfAVVQm2iJXpqfy7nmvnbFtiw+FI6aWBITuLLAMtMVqzqZgj6EjzNffbYkBS7rzAeBJwrLGl1YxnCJCUeGHrdlcQndcMYVUtX1fsxPwra9bsLYJkYltG+w4GWCkfUGRZYWwvGISEumMqu2srf8oe5+ke576dSqmrUqTPR+a3GFuY9jbGI+BOkE5ogAJOls1BpvLebTFTT21mx87TNQzyGS9OnYms2zSOPWfTHd6kwayLHdabN1f1rmxSQOA4wWH8Pi3En+QBWFG7SRSgJRI4SkWqggxvM8/QUFboA5x7QbX1H26MB14hZamuA14KGB4F6j0c1WyqCGXO+cjQo/aHJdbs6KXnkpPgtk+K9BgoyuIMEKbNTcOLALgByRmgFrpC1mF6VOtruu1RUtb62SH4jk+lIssVOBEH3x05WBAARCT6B7TI1shoY60AHScI/OSNDUFoZxJ1ep8iX/7ep2+nVH+o3R8oE5+igFx6jLGdXZzmqwfmDhbustIxn3o1LUwcVRroS/i1Y5qCzv/40CS9/Qcap/P6ECfQTJ0nuIJDrlYYLNdURq4kDz87E3fDtZfViY1os95SyQ9Ht4WPZNlnaY2Pn1ExLgnqq48OC3EUh2zJK0+JLYmMzo4X16SBjondJ+I=
    - secure: aOygIO1zECTraNsXt2IoOlGHZ1ql3lILfmKNDs6kgAMP7G9CbnphQEHl6yZ8Ff0S6iacjS5hxhHO8yV9f3xModZP9RarQJEfd2jU3qY2zaJTGtTtCWPjQQ0LAnUeUxoSuaiQ/8YxSNTpjXkrMb2mJirr9Cny/JoEb+xe/RNlUznIP3/G7lCqvIt5Z+RJmN3ah3hlOCirx8A+kTgwLI33oQmxFVKlMr6JDj3q5a6d64P947t6s42Dxr9KTdX/dN4ArgjSmv+girqpFhTyBeNH9LgUF0zXia8mSGbPcc+ksY3w01q+zRZsNbTlkhyW2HXqWY/LScvyipW196vNWJM2Kft7itqU+OeLjOjNtbIZWkOYP5O35giDNmYUEhE/UyKC37OZ0fau9uHZNWCtGlHlWPEEItzi6aptXXmUBg73tPHr1JPfuJdirFe+O5D5Dc4tmCf/8kj3snKArXT8EQF6N9TqxroF+OnGsiGvoCr5RyAFke3FZSLIb1ODdFKLcRFZ37KPw+AZDkg6oPkXJIEidtQHRFYTQSseEBzxjvMKm/YWgNUgegsHiQ14LxU8EdPPGA8KKYdqNNoOel1HhOfDjbYvMvHvU825MNwHu0Hm1Yep0AM1YZD0lFlN9govRtYHiP11EGXqVYjgR7maaAwY/u0tItXqaeZckNw6tBfaYRQ=
    - secure: ITB0Yfy4gjKw2xn2mbo8D/fK5w0yC+TR1pmaI9DHctks20tMZotVaeRlv3qHpbHbo7wY8Fh0FYWBqEdrmkswoqbPJDCiw1lgJBIlSLteF+gNVKWB9Hqx9roTCMXk2qI3Q1K2WIf+YjDwF9BXJ+w7GS2KAPi8Il5HMCPxmg0U9ON9B+khAW3oUFcPZBVf/AfRe5fVAsHsbbQkywnU/PSJtEf1Km8kGWfFDQAalfbmwrekukSD5mu1cmaKnES1y5i4yz36hUhFOoAZj08HXj+VfvIS6LZ+0bdySZsIdb/JZ2OyM+rGTV9hHdcH+cdNl81OXcxWKdavAR5zK0y4CWxLqQ7t8sEqXHxYB9nM6C8EBYXqfZaAaG7QG24BYBW7w9Ah7mbwb12mLYTunZ0P+g4ShXX7nCe0EBAld0NLny+P/hFRFLuAM4c4SM7LsriFlE9+eEltmAT6Zyel2f51ERG95z8wg9s2SWao9VQivudD6s0M03l4add4fcqf55Tn/IJ55ssw3OscxJveN8Rtnf/78ekQVerrBm9ka1UfZIWMGHLGSyzadkY7jyaxEWkwZfP8FXe42WIP0wSiLkPohMIAjevSgmMn/Ljxuc3b7A1ZjAUCuYJUaSheph4tNmtM8GcvfGjFnF9b5e4ajAeLKOgplfVykspf8H2H5Vk7bL3s/2w=

script:
  - mvn clean install -B

before_deploy:
  # Set tag to be used by releases provider
  - export TRAVIS_TAG=$POM_VERSION

deploy:
  # For any checkin to main branch, create a final version, tag it and push the artifacts to Sonatype
  - provider: script
    skip_cleanup: true
    script:
      mvn --settings .travis/maven-settings.xml release:prepare release:perform -DskipTests -Prelease -B
    on:
      branch: main

  # Releases config copied from https://docs.travis-ci.com/user/deployment/releases/ and secure key generated by following
  # https://stackoverflow.com/questions/25302518/travis-ci-setup-releases-with-github-token#answer-57032190
  - provider: releases
    api_key:
      secure: U3DNN/NkzVD4N2rQsOCPm+LJznMTuxvZD0gPzs0v8I6ULCEYpXu6x50p+47apQnNLLFSlbB6oR8Sv06IfwijCS8QZTB3K0pkSkeO6COSFkS2f+8+zY11sS8rJPllrU8dKsU+TIx4sEujel37XXCYQQ/8FovPVfNs3GePs0P3a6Ry1dYBV4p4FdC+Ctat8q3zCwl3+CjX0/4rjVwqYiif78xJvB0PuC9lYYMMehQvVVBdpSCemkaPiS8EpZQZjS2Dv/NP6001+ODCPcGwqnGZ9X18uKrIKzmHgh4KpYUrrRyppxxM5nZsFL1gP0ob60KO2TPEssamIxYjQw4CpTCsxm0h6cJ08NOF6KyCFVX6TKrqZMT7SFEK6SZZtuvdgOZ7bhNsjUBjQkUscg46J+kcmoEw6rdHGWzTrKQ2UTfpcP4VkQEcLnJZ83oG9WM5AAoNsplLPQe0zHQyzufL6G8ye8pRjrjaZHKbKgXGXjYu7CIh1tGyaJRplA3NBB9l62CFMVj9fiVd8q56DwH8kMFSoV9pX2LxVyXzZbbdHEQOiOLa6UKhmDCQ+hnHeIFnnTtb++q4y9ZRarAepbddH2ibO+eANEJQvQgTQmy9CF63D6WrPn/2hw/QK8qhSYeqvnfoWi7ZH17m/nkXZwa4zjtg/sxzfx70XwjmtJQldmUyTdk=
    file: "target/spt-development-logging-spring-${POM_VERSION}.jar"
    skip_cleanup: true
    on:
      branch: main
